#!/bin/bash

# Define some colors.
COL="\033[1;35m"
END="\033[0m"

function echo_info() {
  echo "${COL}$1${END}"
}

function newline() {
  echo
}


# Stop execution if the $DOTFILES environment variable is not set.
if [ -z "$DOTFILES" ]; then
  echo_info 'Set the $DOTFILES env variable before running this.'
  exit 1
fi


# Proceed only if the user is sure she installed the command-line tools and
# agreed to the Xcode license. No need to install Xcode anymore!
echo_info 'Before going on, I need to be sure you installed the command-line'
echo_info 'tools and agreed to the Xcode license:'
echo '  xcode-select --install'
echo '  sudo xcodebuild -license'

read -p "Did you? [yn] " -n 1 -r
newline
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
  exit 0
fi



# Oh My Zsh
echo_info "Installing oh-my-zsh"
curl -L http://install.ohmyz.sh | sh
newline


# RVM for the rubiess
echo_info "Installing RVM"
curl -sSL https://get.rvm.io | bash -s stable --ruby
newline


# For the c alias (syntax highlighted cat) install Pygments.
echo_info "Installing Pygments (for the 'c' alias) - this needs sudo"
sudo easy_install Pygments
newline


echo_info "Installing Homebrew"
ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
newline

echo_info "Cloning dotfiles from GitHub"
git clone https://github.com/whatyouhide/dotfiles.git "$DOTFILES"
newline

echo_info "Just to be sure, remove ~/.profile and ~/.zprofile"
rm -v ~/.profile ~/.zprofile
newline


echo_info "Be sure to reload your shell in order to see changes"
echo 'Also hop up into $DOTFILES and list rake tasks with `rake -T`'
